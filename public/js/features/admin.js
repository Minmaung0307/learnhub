import { el, toast } from '../services/ui.js'; import { getFirebase, isAdmin } from '../services/firebase.js'; import { onAuth } from '../services/auth.js';
export async function viewAdmin(){ const app=document.getElementById('app'); app.innerHTML=''; const user=await new Promise(r=>onAuth(r)); if(!user) return app.append(el('p',{},'Please login.')); if(!(await isAdmin(user.uid))) return app.append(el('p',{},'Admins only.'));
  app.append(el('h2',{},'Admin Tools')); const panel=el('section',{class:'admin-tools'}); panel.append(card('Seed Demo (reset)','Reset & seed demo',()=>seedDemo()), card('Set Me Admin','Write roles/{uid}: admin',()=>setMeAdmin())); app.append(panel);
  function card(t,d,f){ return el('div',{class:'card'},[el('h3',{},t),el('p',{},d),el('button',{class:'btn primary',onclick:f},'Run')]); }
  async function setMeAdmin(){ const {db,doc,setDoc}=await getFirebase(); await setDoc(doc(db,'roles',user.uid),{role:'admin',at:Date.now()},{merge:true}); toast('You are admin now.'); }
  async function seedDemo(){ const {db,doc,writeBatch,collection,getDocs}=await getFirebase(); const colls=['courses','messages','tasks','enrollments']; for(const c of colls){ const snap=await getDocs(collection(db,c)); const b=writeBatch(db); snap.forEach(d=>b.delete(doc(db,c,d.id))); await b.commit(); } const b=writeBatch(db); const demo=[{id:'js-101',title:'JavaScript 101',short:'Basics for web dev',type:'free',credit:1,image:'https://images.unsplash.com/photo-1555066931-4365d14bab8c?q=80&w=1200&auto=format&fit=crop'},{id:'css-mastery',title:'CSS Mastery',short:'Layouts & animations',type:'paid',price:9.9,credit:2,image:'https://images.unsplash.com/photo-1551033406-611cf9a28f67?q=80&w=1200&auto=format&fit=crop'}]; demo.forEach(c=>b.set(doc(db,'courses',c.id),c)); await b.commit(); toast('Seeded.'); } }